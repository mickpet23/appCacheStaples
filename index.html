<!DOCTYPE html>
<html manifest="offline.manifest">
<head>
	<link rel="stylesheet" type="text/css" href="./styles.css"/>
	<title>AppCache Staples</title>
</head>
<body>
	<h1>Grocery Staples 38</h1>
	<input type="text">
	<button>Add</button>
	<ul></ul>
	<script type="text/javascript">
		/*
		//import from 'https://unpkg' causes errors in ios 10.3 safari.
		//TODO: try to get this to work
		import { openDB, deleteDB } from 'https://unpkg.com/idb?module';

		let dbPromise = openDB('grocery-db', 1, {
			upgrade(dbPromise, oldVersion, newVersion, transaction) {
				switch(oldVersion) {
					case 0:
					dbPromise.createObjectStore('staples', {keyPath: 'item'});
				}
			}
		})

		dbPromise.then(db => {
			let tx = db.transaction('staples', 'readwrite');
			let staplesStore = tx.objectStore('staples');
			staplesStore.put({item: 'milk'})
		})
		*/

		//localStorage.setItem('mydog', 'Machomon');
		//localStorage.removeItem('mydog');

		const addButton = document.getElementsByTagName('button')[0];
		const inputEl = document.getElementsByTagName('input')[0];
		const ulEl = document.getElementsByTagName('ul')[0];

		let itemsArray;
		if (localStorage.getItem('items')) {
			itemsArray = JSON.parse(localStorage.getItem('items'));
			itemsArray.map(item => {
				let newLi = document.createElement('li');
				newLi.appendChild(document.createTextNode(item));
				let deleteButton = document.createElement('button');
				deleteButton.appendChild(document.createTextNode('Delete'));
				newLi.appendChild(deleteButton);
				ulEl.appendChild(newLi);
				deleteButton.addEventListener('click', () => {
					ulEl.removeChild(deleteButton.parentElement);
				})
			})
		} else {
			itemsArray = [];
			localStorage.setItem('items', JSON.stringify(itemsArray));
		}



		addButton.addEventListener('click', () => {
			let newLI = document.createElement('li');
			newLI.appendChild(document.createTextNode(inputEl.value));
			let deleteButton = document.createElement('button');
			deleteButton.appendChild(document.createTextNode('Delete'));
			newLI.appendChild(deleteButton);	
			ulEl.appendChild(newLI);

			itemsArray.push(inputEl.value);
			localStorage.setItem('items', JSON.stringify(itemsArray));

			inputEl.value = '';

			deleteButton.addEventListener('click', () => {
				ulEl.removeChild(deleteButton.parentElement);
			})
		})
	</script>
</body>
</html>